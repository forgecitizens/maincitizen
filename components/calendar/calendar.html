<!DOCTYPE html>
<!--
========================================================================
CALENDRIER WINDOWS R√âTRO - COMPOSANT AUTONOME
========================================================================

Interface HTML d√©di√©e au calendrier, int√©gr√©e dans le syst√®me de modales.
Structure :
- Titre de fen√™tre Windows avec boutons de contr√¥le
- Conteneur pour l'instance JavaScript du calendrier  
- Int√©gration transparente avec l'√©cosyst√®me r√©tro existant

Ce fichier sera charg√© dynamiquement dans une modale par le syst√®me principal.
-->
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier R√©tro</title>
    <style>
        /* Reset minimal pour l'int√©gration */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'MS Sans Serif', sans-serif;
            background: #c0c0c0;
            padding: 0;
            margin: 0;
        }
        
        /* Conteneur principal sans padding suppl√©mentaire */
        .calendar-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        /* Header de fen√™tre Windows style */
        .window-header {
            background: linear-gradient(90deg, #000080 0%, #0000a0 100%);
            color: #ffffff;
            padding: 2px 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
            font-weight: bold;
            border-bottom: 1px solid #808080;
            user-select: none;
        }
        
        .window-title {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .control-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            font-size: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000000;
            font-weight: bold;
        }
        
        .control-btn:active {
            border: 1px inset #c0c0c0;
            background: #a0a0a0;
        }
        
        .control-btn:hover {
            background: #d0d0d0;
        }
        
        /* Conteneur du calendrier proprement dit */
        .calendar-mount-point {
            flex-grow: 1;
            padding: 8px;
            background: #c0c0c0;
            overflow: auto;
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .window-header {
                font-size: 10px;
            }
            
            .control-btn {
                width: 14px;
                height: 12px;
                font-size: 7px;
            }
            
            .calendar-mount-point {
                padding: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <!-- Header de fen√™tre Windows -->
        <div class="window-header">
            <div class="window-title">
                <span>üìÖ</span>
                <span>Calendrier</span>
            </div>
            <div class="window-controls">
                <button class="control-btn minimize-btn" title="R√©duire" onclick="minimizeCalendar()">_</button>
                <button class="control-btn maximize-btn" title="Agrandir" onclick="maximizeCalendar()">‚ñ°</button>
                <button class="control-btn close-btn" title="Fermer" onclick="closeCalendar()">‚úï</button>
            </div>
        </div>
        
        <!-- Point de montage pour le calendrier JavaScript -->
        <div class="calendar-mount-point" id="calendar-mount-point">
            <!-- Le composant calendrier sera inject√© ici par JavaScript -->
        </div>
    </div>
    
    <script>
        /**
         * ========================================================================
         * FONCTIONS D'INTERFACE WINDOWS
         * ========================================================================
         * 
         * Ces fonctions g√®rent l'interaction avec les contr√¥les de fen√™tre
         * et l'int√©gration avec le syst√®me de modales principal.
         */
        
        /**
         * Minimise la fen√™tre calendrier (cache la modale)
         */
        function minimizeCalendar() {
            // Jouer son de clic si disponible
            if (typeof playClickSound === 'function') {
                playClickSound();
            }
            
            // Si int√©gr√© dans une modale, la fermer
            if (window.parent && window.parent.closeModal) {
                window.parent.closeModal();
            } else if (window.closeModal) {
                closeModal();
            } else {
                // Fallback : cacher la fen√™tre
                document.body.style.display = 'none';
            }
            
            console.log('üìÖ Calendrier minimis√©');
        }
        
        /**
         * Bascule le mode plein √©cran (maximis√©/restaur√©)
         */
        function maximizeCalendar() {
            // Jouer son de clic si disponible
            if (typeof playClickSound === 'function') {
                playClickSound();
            }
            
            const container = document.querySelector('.calendar-container');
            const btn = document.querySelector('.maximize-btn');
            
            if (container.classList.contains('maximized')) {
                // Restaurer
                container.classList.remove('maximized');
                container.style.width = '';
                container.style.height = '';
                btn.textContent = '‚ñ°';
                btn.title = 'Agrandir';
            } else {
                // Maximiser
                container.classList.add('maximized');
                container.style.width = '100vw';
                container.style.height = '100vh';
                btn.textContent = '‚ùê';
                btn.title = 'Restaurer';
            }
            
            console.log('üìÖ Calendrier maximis√©/restaur√©');
        }
        
        /**
         * Ferme d√©finitivement la fen√™tre calendrier
         */
        function closeCalendar() {
            // Jouer son de clic si disponible
            if (typeof playClickSound === 'function') {
                playClickSound();
            }
            
            // D√©monter proprement le calendrier
            if (window.unmountCalendar) {
                unmountCalendar();
            }
            
            // Si int√©gr√© dans une modale, la fermer
            if (window.parent && window.parent.closeModal) {
                window.parent.closeModal();
            } else if (window.closeModal) {
                closeModal();
            } else {
                // Fallback : fermer la fen√™tre
                window.close();
            }
            
            console.log('üìÖ Calendrier ferm√©');
        }
        
        /**
         * ========================================================================
         * INITIALISATION DU CALENDRIER
         * ========================================================================
         * 
         * Monte automatiquement le composant calendrier au chargement
         */
        
        document.addEventListener('DOMContentLoaded', function() {
            const mountPoint = document.getElementById('calendar-mount-point');
            
            if (!mountPoint) {
                console.error('‚ùå Point de montage calendrier introuvable');
                return;
            }
            
            // Attendre que les scripts externes soient charg√©s
            function initCalendar() {
                if (typeof mountCalendar === 'function') {
                    try {
                        mountCalendar(mountPoint, {
                            // Options de configuration si besoin
                            showClock: true,
                            enableNotes: true,
                            theme: 'retro'
                        });
                        
                        console.log('‚úÖ Calendrier initialis√© avec succ√®s');
                    } catch (error) {
                        console.error('‚ùå Erreur initialisation calendrier:', error);
                        
                        // Afficher un message d'erreur √† l'utilisateur
                        mountPoint.innerHTML = `
                            <div style="padding: 20px; text-align: center; color: #800000;">
                                <p><strong>‚ö†Ô∏è Erreur de chargement</strong></p>
                                <p>Le calendrier n'a pas pu s'initialiser.</p>
                                <p style="font-size: 10px; color: #606060; margin-top: 10px;">
                                    ${error.message}
                                </p>
                            </div>
                        `;
                    }
                } else {
                    // R√©essayer dans 100ms si les scripts ne sont pas encore charg√©s
                    setTimeout(initCalendar, 100);
                }
            }
            
            initCalendar();
        });
        
        /**
         * Nettoyage √† la fermeture de la fen√™tre
         */
        window.addEventListener('beforeunload', function() {
            if (window.unmountCalendar) {
                unmountCalendar();
            }
        });
        
        /**
         * Support des raccourcis clavier
         */
        document.addEventListener('keydown', function(event) {
            // ESC = fermer
            if (event.key === 'Escape') {
                closeCalendar();
            }
            
            // F11 = basculer plein √©cran
            if (event.key === 'F11') {
                event.preventDefault();
                maximizeCalendar();
            }
            
            // Ctrl+W = fermer
            if (event.ctrlKey && event.key === 'w') {
                event.preventDefault();
                closeCalendar();
            }
        });
    </script>
</body>
</html>